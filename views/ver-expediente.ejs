<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Ver Expediente de <%= nino.nombre_completo %></title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/postulaciones.css" rel="stylesheet">
  <link href="/css/navbarStyles.css" rel="stylesheet">
</head>
<body>
  <%- include('navbar') %>

  <div class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 class="mb-0">Expediente de: <%= nino.nombre_completo %></h2>
      <a href="/expedientes" class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i> Volver a Expedientes
      </a>
    </div>

    <% if (success_msg) { %>
      <div class="alert alert-success alert-dismissible fade show" role="alert">
        <%= success_msg %>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    <% } %>
    <% if (error_msg) { %>
      <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <%= error_msg %>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    <% } %>

    <div class="main-card p-4">
      <ul class="nav nav-tabs mb-4" id="expedienteTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="datos-tab" data-bs-toggle="tab" data-bs-target="#datos" type="button" role="tab" aria-controls="datos" aria-selected="true">Datos del Niño</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="representantes-tab" data-bs-toggle="tab" data-bs-target="#representantes" type="button" role="tab" aria-controls="representantes" aria-selected="false">Representantes</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="documentos-tab" data-bs-toggle="tab" data-bs-target="#documentos" type="button" role="tab" aria-controls="documentos" aria-selected="false">Documentos</button>
        </li>
      </ul>

      <div class="tab-content" id="expedienteTabsContent">
        <!-- Contenido de Datos del Niño -->
        <div class="tab-pane fade show active" id="datos" role="tabpanel" aria-labelledby="datos-tab">
          <div class="row">
            <div class="col-md-6">
              <p><strong>Código:</strong> <%= nino.codigo %></p>
              <p><strong>Nombre Completo:</strong> <%= nino.nombre_completo %></p>
              <p><strong>Fecha de Nacimiento:</strong> <%= nino.fecha_nacimiento ? new Date(nino.fecha_nacimiento).toLocaleDateString() : 'N/A' %></p>
              <p><strong>Edad:</strong> <%= nino.edad || 'N/A' %></p>
            </div>
            <div class="col-md-6">
              <p><strong>Diagnóstico:</strong> <%= nino.diagnostico || 'N/A' %></p>
              <p><strong>Referido por:</strong> <%= nino.referido_por || 'N/A' %></p>
              <p><strong>Fecha de Creación:</strong> <%= nino.fecha_creacion ? new Date(nino.fecha_creacion).toLocaleDateString() : 'N/A' %></p>
            </div>
          </div>
          <div class="d-flex justify-content-end mt-4">
            <a href="/expedientes/editar/<%= nino.id %>" class="btn btn-warning">✏️ Editar Expediente</a>
          </div>
        </div>

        <!-- Contenido de Representantes -->
        <div class="tab-pane fade" id="representantes" role="tabpanel" aria-labelledby="representantes-tab">
          <% if (representantes && representantes.length > 0) { %>
            <% representantes.forEach(r => { %>
              <div class="card mb-3">
                <div class="card-body">
                  <h5 class="card-title"><%= r.nombre %></h5>
                  <p class="card-text">
                    <strong>DPI:</strong> <%= r.dpi || 'N/A' %><br>
                    <strong>Parentesco:</strong> <%= r.parentesco || 'N/A' %><br>
                    <strong>Teléfono:</strong> <%= r.telefono || 'N/A' %><br>
                    <strong>Dirección:</strong> <%= r.direccion || 'N/A' %>
                  </p>
                </div>
              </div>
            <% }) %>
          <% } else { %>
            <p>No hay representantes legales registrados.</p>
          <% } %>
        </div>

        <!-- Contenido de Documentos -->
        <div class="tab-pane fade" id="documentos" role="tabpanel" aria-labelledby="documentos-tab">
          <ul class="list-group">
            <% if (documentos && documentos.length > 0) { %>
              <% documentos.forEach(d => { %>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <div>
                    <strong><%= d.tipo %></strong>
                    <span class="badge bg-secondary ms-2"><%= d.confirmado ? 'Confirmado' : 'Pendiente' %></span>
                    <small class="text-muted ms-2">(Subido: <%= new Date(d.fecha_subida).toLocaleDateString() %>)</small>
                  </div>
                  <div>
                    <a href="/<%= d.archivo %>" class="btn btn-sm btn-info" target="_blank">
                      <i class="fas fa-eye"></i> Ver
                    </a>
                  </div>
                </li>
              <% }) %>
            <% } else { %>
              <li class="list-group-item text-center">No hay documentos registrados.</li>
            <% } %>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
